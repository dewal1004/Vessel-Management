OBJECT Modification "Job Journal Batch"(Table 237)
{
  OBJECT-PROPERTIES
  {
    Date=20220216D;
    Time=164357.667T;
    Modified=true;
    Version List=NAVW114.00;
  }
  PROPERTIES
  {
    Target="Job Journal Batch"(Table 237);
  }
  CHANGES
  {
    { PropertyModification;
                         Target="Journal Template Name"(Field 1);
                         Property=Data type;
                         OriginalValue=Code10;
                         ModifiedValue=Code20 }
    { Insertion         ;OnValidate=BEGIN

                                      if FA.Get(Name) then
                                        "Global Dimension 2 Code":=FA."Global Dimension 2 Code";
                                      if locat.Get(Name) then "Vessel Name":=locat.Name;
                                    END;

                         Target=Name(Field 2) }
    { PropertyModification;
                         Target=Name(Field 2);
                         Property=Data type;
                         OriginalValue=Code10;
                         ModifiedValue=Code20 }
    { PropertyInsertion ;Target=Name(Field 2);
                         Property=TableRelation;
                         ModifiedValue=IF ("Journal Template Name"=CONST('RECURRING')) Location WHERE ("Location Type"=CONST(Vessel)) }
    { Insertion         ;InsertAfter=Recurring(Field 22);
                         ChangedElements=FieldCollection
                         {
                           { 50300;  ;Voyage No.          ;Code10         }
                           { 50301;  ;Catch Date          ;Date          ;OnValidate=BEGIN
                                                                                       //Report Daily Variables
                                                                                       if "Catch Date">Today then Error('Catch date cannot be in the future');
                                                                                       OPDailyRad.Init;
                                                                                       OPDailyRad.Date:="Catch Date";
                                                                                       OPDailyRad.Name:=Name;
                                                                                       OPDailyRad.Description:=Description;
                                                                                       OPDailyRad."Reason Code":="Reason Code";
                                                                                       OPDailyRad."Voyage No.":="Voyage No.";
                                                                                       OPDailyRad."Catch Date":="Catch Date";
                                                                                       OPDailyRad."Fishing Ground":="Fishing Ground";
                                                                                       OPDailyRad."Sea Temperature":="Sea Temperature";
                                                                                       OPDailyRad."Job No.":="Job No.";
                                                                                       OPDailyRad."Global Dimension 2 Code":="Global Dimension 2 Code";
                                                                                       OPDailyRad."Fish Hold Temp":="Fish Hold Temp";
                                                                                       OPDailyRad."Fuel Balance":="Fuel Balance";
                                                                                       OPDailyRad."R.P.M.":="R.P.M.";
                                                                                       if jobs.Get("Job No.") then
                                                                                       begin
                                                                                         OPDailyRad."Catch Sea Days":="Catch Date"-jobs."Starting Date";
                                                                                       end;

                                                                                       if not OPDailyRad.Insert then OPDailyRad.Modify;

                                                                                       //No Catch Reports Skipper
                                                                                       if JLedEntry.FindLast then "LastNo." := JLedEntry."Entry No.";
                                                                                       JLedEntry.Init;
                                                                                       JLedEntry."Job No.":="Job No.";
                                                                                       JLedEntry."Posting Date":="Catch Date";
                                                                                       JLedEntry."Document No.":=Name+Format("Catch Date");
                                                                                       JLedEntry.Type:=0;
                                                                                       if jobs.Get("Job No.") then
                                                                                       begin
                                                                                         JLedEntry.Validate("No.",jobs."Person Responsible");

                                                                                         JLedEntry2."Catch Sea Days":="Catch Date"-jobs."Starting Date";
                                                                                       end;
                                                                                       JLedEntry.Quantity:=1;
                                                                                       JLedEntry."Unit of Measure Code":='DAY';
                                                                                       JLedEntry."Job Task No.":='TEMP';
                                                                                       JLedEntry."Location Code":=Name;
                                                                                       //JLedEntry.Chargeable:=FALSE;
                                                                                       JLedEntry."User ID":=UserId;
                                                                                       JLedEntry."Source Code":='Direct';
                                                                                       JLedEntry."Entry Type":=0;
                                                                                       JLedEntry."Entry No.":="LastNo."+1;
                                                                                       JLedEntry."Phase Code":="Fishing Ground";
                                                                                       if jobs.Get("Job No.") then
                                                                                       begin
                                                                                         JLedEntry."Catch Sea Days":="Catch Date"-jobs."Starting Date";
                                                                                       end;
                                                                                       //JLedEntry."Step Code":=FORMAT("Sea Temperature");
                                                                                       JLedEntry2.SetRange(JLedEntry2."Job No.","Job No.");
                                                                                       JLedEntry2.SetRange(JLedEntry2."Posting Date","Catch Date");
                                                                                       JLedEntry2.SetRange(JLedEntry2.Type,0);
                                                                                       if JLedEntry2.Find('-') then
                                                                                       begin
                                                                                        if JLedEntry3.Get(JLedEntry3."Entry No.") then
                                                                                        JLedEntry3."Entry No.":=JLedEntry2."Entry No.";
                                                                                        if not JLedEntry.Modify then Message('System in Use by other users, request them to shut down');
                                                                                       end
                                                                                       else
                                                                                       JLedEntry.Insert;

                                                                                       locat.SetRange(locat.Code,Rec.Name);
                                                                                       if locat.FindFirst then
                                                                                         locat."Catch Date" := Rec."Catch Date";
                                                                                     END;
                                                                                      }
                           { 50303;  ;Fishing Ground      ;Code30        ;TableRelation="Job Task"."Job Task No.";
                                                                          OnValidate=BEGIN
                                                                                       //"Catch Date":=TODAY;
                                                                                       if JobsRec.Get("Job No.") then
                                                                                         if JobsRec."Voyage Ended" then Message('You may not post on Ended Voyage');
                                                                                     END;
                                                                                      }
                           { 50304;  ;Sea Temperature     ;Decimal       ;OnValidate=BEGIN
                                                                                       //"Catch Date":=TODAY;
                                                                                       if JobsRec.Get("Job No.") then
                                                                                         if JobsRec."Voyage Ended" then Message('You may not post on Ended Voyage');
                                                                                     END;

                                                                          MinValue=0;
                                                                          MaxValue=100 }
                           { 50305;  ;Job No.             ;Code20        ;TableRelation=Job WHERE (Vessel=FIELD(Name),
                                                                                                   Status=FILTER(Open));
                                                                          OnValidate=BEGIN
                                                                                       //"Catch Date":=TODAY;
                                                                                       if User.Get(UserId) then
                                                                                       "Global Dimension 2 Code":=User."Global Dimension 2 Code";

                                                                                       if JobsRec.Get("Job No.") then
                                                                                       begin
                                                                                         //JobsRec.CALCFIELDS(JobsRec."Fishing Area",JobsRec."Sea Temperature");
                                                                                         JobsRec."Fishing Area" := JobsRec.FishArea("Job No.",'',"Global Dimension 2 Code",'',
                                                                                           '','','','','','');
                                                                                         JobsRec."Sea Temperature" := JobsRec.SeaTemperature("Job No.",'',"Global Dimension 2 Code",'',
                                                                                         '','','','','','');
                                                                                         "Voyage No.":=JobsRec."Voyage No.";
                                                                                         "Global Dimension 2 Code":=JobsRec."Global Dimension 2 Code";
                                                                                         "Fishing Ground":=JobsRec."Fishing Area";
                                                                                         if Evaluate("Sea Temperature",JobsRec."Sea Temperature") then;
                                                                                       end;
                                                                                       locat.SetRange(locat.Code,Rec.Name);
                                                                                       if locat.FindFirst then
                                                                                         locat."Catch Date" := Rec."Catch Date";
                                                                                         {IF NOT locat.MODIFY(TRUE) THEN
                                                                                           locat.INSERT;}//nitin
                                                                                     END;
                                                                                      }
                           { 50317;  ;Global Dimension 2 Code;Code20     ;TableRelation="Dimension Value".Code WHERE ("Global Dimension No."=CONST(2));
                                                                          CaptionML=ENU=Global Dimension 2 Code;
                                                                          NotBlank=true;
                                                                          CaptionClass='1,1,2' }
                           { 50318;  ;Init Journal        ;Boolean       ;InitValue=false }
                           { 50320;  ;Fish Hold Temp      ;Decimal       ;OnValidate=BEGIN
                                                                                       //"Catch Date":=TODAY;
                                                                                     END;
                                                                                      }
                           { 50322;  ;Fuel Balance        ;Decimal       ;OnValidate=BEGIN
                                                                                       //"Catch Date":=TODAY;
                                                                                       if JobsRec.Get("Job No.") then
                                                                                         if JobsRec."Voyage Ended" then Message('You may not post on Ended Voyage');
                                                                                       locat.SetRange(locat.Code,Rec.Name);
                                                                                       if locat.FindFirst then
                                                                                         locat."Catch Date" := Rec."Catch Date";
                                                                                         {IF NOT locat.MODIFY(TRUE) THEN
                                                                                           locat.INSERT;}//nitin
                                                                                     END;
                                                                                      }
                           { 50323;  ;R.P.M.              ;Decimal       ;OnValidate=BEGIN
                                                                                       //"Catch Date":=TODAY;
                                                                                     END;
                                                                                      }
                           { 50324;  ;Vessel Name         ;Text30         }
                           { 50325;  ;Batch Type          ;Option        ;OptionString=,EXPT,MRKT,CONS }
                           { 50326;  ;Posted              ;Boolean        }
                         }
                          }
    { CodeModification  ;OriginalCode=BEGIN
                                        LockTable;
                                        JobJnlTemplate.Get("Journal Template Name");
                                      END;

                         ModifiedCode=BEGIN
                                        //LOCKTABLE;//nitin
                                        JobJnlTemplate.Get("Journal Template Name");
                                      END;

                         Target=OnInsert }
    { Insertion         ;InsertAfter=JobJnlLine(Variable 1003);
                         ChangedElements=VariableCollection
                         {
                           "------"@1014 : Integer;
                           User@1013 : Record "User Setup";
                           JobsRec@1012 : Record Job;
                           jobs@1011 : Record Job;
                           JLedEntry@1010 : Record "Job Ledger Entry";
                           JLedEntry2@1009 : Record "Job Ledger Entry";
                           JLedEntry3@1008 : Record "Job Ledger Entry";
                           FA@1007 : Record "Fixed Asset";
                           OPDailyRad@1006 : Record "Operation Daily Radio";
                           "LastNo."@1005 : Integer;
                           locat@1004 : Record Location;
                           Res@1015 : Record Resource;
                           g_Name@1016 : Text;
                         }
                          }
    { PropertyInsertion ;Property=Permissions;
                         ModifiedValue=TableData "Job Ledger Entry"=rimd }
  }
  CODE
  {

    BEGIN
    END.
  }
}

